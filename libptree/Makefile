SHELL		:= /bin/sh

# Include local configuration file (generated by ./configure) ########
_CONFIGURE_DIR	:= ..
_CONFIGURE	:= $(_CONFIGURE_DIR)/configure
_CONFIG_MAK	:= $(_CONFIGURE_DIR)/config.mak
sinclude $(_CONFIG_MAK)


# Sources ############################################################
SRCS		= $(wildcard *.cpp)


# Objects ############################################################
OBJS		+= $(SRCS:.cpp=.o)


# Executables ########################################################
TEST		= 
#BINS		= $(TEST)$(BINSUF)


# Documentation ######################################################
DOCS		:=


# Includes ###########################################################
INCLUDES	+= -I../gsoap -I../libsrm2api -I$(_with_gsoapdir)/include
CPPFLAGS	+= $(INCLUDES)
INCS		:=


# Libraries ##########################################################
LIB		= libptree$(LIBSUF)
ifeq ($(_enable_shared),yes)
SLIB		= libptree$(SLIBSUF)
endif
LIBS		= $(LIB)


# Extra libraries ####################################################


# Rules ##############################################################
.PHONY: Makefile

ifneq ($(CONFIG_MAK),)
all: depend $(LIBS) $(BINS)
endif

$(_CONFIG_MAK):
	@echo "Please run ./configure to generate $(_CONFIG_MAK)" >&2
	@exit 1

$(LIB): $(OBJS)
	rm -f $@
	$(AR) rc $@ $^
	$(RANLIB) $@

$(SLIB): $(OBJS)
	$(CC) $(SHFLAGS) -o $@ $(OBJS)


# Generate dependencies ##############################################
dep depend: .depend

.depend: $(SRCS)
	$(CC) -MM $(CPPFLAGS) $(INCLUDES) $^ 1>.depend

ifneq ($(wildcard .depend),)
include .depend
endif


# Install ############################################################
#install: all install-bins install-docs install-libs install-incs
install: all

install-bins: $(BINS)
	@if test -n "$(BINS)" ; then\
	  mkdir -p $(prefix)$(_bindir) ;\
	  install -m 0755 $(BINS) $(prefix)$(_bindir) ;\
	fi

install-docs: $(DOCS)
	@if test -n "$(DOCS)" ; then\
	  mkdir -p $(prefix)$(_docdir) ;\
	  install -m 0644 $(DOCS) $(prefix)$(_docdir) ;\
	fi

install-incs: $(INCS)
	@for dir in $(INCS) ;\
	do \
	  mkdir -p $(prefix)$(_includedir)/`dirname $$dir` ;\
	  install -m 0644 $(INCS) $(prefix)$(_includedir)/`dirname $$dir` ;\
	done

install-libs: $(LIBS)
	@if test -n "$(LIBS)" ; then\
	  mkdir -p $(prefix)$(_libdir) ;\
	  install -m 0644 $(LIBS) $(prefix)$(_libdir) ;\
	fi


# Cleanup ############################################################
.PHONY: clean distclean mclean

clean: 
	-rm -f *.o .libs $(LIBS) $(BINS)

distclean mclean: clean
	-rm -f `basename $(CONFIG_H)` $(CONFIG_MAK) $(VERSION_H) .depend 
