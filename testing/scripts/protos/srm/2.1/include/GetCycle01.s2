; GetCycle with one file
;
; @param: ${fileToGet}
; @param: ${sURL}
;
; srmPrepareToGet
; srmStatusOfGetRequest

#include ../include/FileTransGet.s2

DEFUN GetCycle01 fileToGet sURL
   srmPrepareToGet $ENV{SRM_ENDPOINT} userID=$ENV{USER} arrayOfFileRequests.fileStorageType[$ENV{STORAGE_TYPE}] arrayOfFileRequests.SURLOrStFN[${sURL}] arrayOfTransferProtocols[$ENV{TRANS_PROT0} $ENV{TRANS_PROT1}] requestToken=(?P<getRequestToken>.*) fileStatuses=".*returnStatus.statusCode0=SRM_REQUEST_QUEUED.*" returnStatus.explanation=(?P<rs_explanation>.*) returnStatus.statusCode=(SRM_SUCCESS|SRM_DONE|SRM_REQUEST_QUEUED)
      SYSTEM echo "srmPrepareToGet: getRequestToken=${getRequestToken}" >> $ENV{S2_LOG}
      && >1||3 SLEEP $ENV{SLEEP_SOR}
         srmStatusOfGetRequest $ENV{SRM_ENDPOINT} userID=$ENV{USER} requestToken=${getRequestToken} surlArray[${sURL}] fileStatuses=".*returnStatus.statusCode0=(SRM_SUCCESS|SRM_DONE|SRM_FILE_IN_CACHE) .*transferURL0=(?P<transferURL0>.*?)( |$)" returnStatus.explanation=(?P<rs_explanation>.*) returnStatus.statusCode=(SRM_SUCCESS|SRM_DONE)
            SYSTEM echo "srmStatusOfGetRequest: transferURL0=${transferURL0}" >> $ENV{S2_LOG}
         || SYSTEM echo "srmStatusOfGetRequest failed" >> $ENV{S2_LOG} && exit 2
      && FUN FileTransGet ${fileToGet} ${transferURL0}
   && SYSTEM echo "Get cycle succeeded; wrote a file from ${sURL} to ${fileToGet}" >> $ENV{S2_LOG}
