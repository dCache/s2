SHELL		:= /bin/sh

# Include local configuration file (generated by ./configure) ########
_CONFIGURE_DIR	:= ..
_CONFIGURE	:= $(_CONFIGURE_DIR)/configure
_CONFIG_MAK	:= $(_CONFIGURE_DIR)/config.mak
sinclude $(_CONFIG_MAK)

# Documentation ######################################################
DOCS		:= \
  s2.txt


# Manual pages #######################################################
MANS		:= \
  s2.1


# Rules ##############################################################
.PHONY: Makefile

ifneq ($(CONFIG_MAK),)
all: $(VERSION_H) $(SUBDIRS)
	@for dir in $(SUBDIRS) ;\
	do \
	  make -C "$$dir" || exit $$? ;\
	done
endif

$(_CONFIG_MAK):
	@echo "Please run ./configure to generate $(_CONFIG_MAK)" >&2
	@exit 1

all: doc man

doc: $(DOCS)
man: $(MANS)

# Install ############################################################
install: install-subdirs install-docs install-man

install-subdirs: $(SUBDIRS)
	@for dir in $(SUBDIRS) ;\
	do \
	  make -C "$$dir" install || exit $$? ;\
	done

install-docs: $(DOCS)
	@if test -n "$(DOCS)" ; then\
	  mkdir -p $(prefix)$(_docdir) ;\
	  install -m 0644 $(DOCS) $(prefix)$(_docdir) ;\
	fi

install-man: $(MANS)
	@if test -n "$(MANS)" ; then\
	  mkdir -p $(prefix)$(_mandir) ;\
	  install -m 0644 $(MANS) $(prefix)$(_mandir) ;\
	fi


# Cleanup ############################################################
.PHONY: clean clean-subdirs dependclean cvsclean svnclean rpmclean distclean mclean

clean: clean-subdirs
	-find locale \( -name *.po[~t] -or -name *.mo \) | xargs rm -f

clean-subdirs:
	@for dir in $(SUBDIRS) $(DOCDIRS) $(WEBDIRS) ;\
	do \
	  make -C "$$dir" clean || exit $$? ;\
	done

svnclean:
	-find . -name .svn -type d -exec rm -rf {} \;

dependclean:
	-find . -name .depend -type d -exec rm -f {} \;

rpmclean: dependclean

distclean mclean: clean
	@for dir in $(SUBDIRS) $(DOCDIRS) $(WEBDIRS) ;\
	do \
	  make -C "$$dir" distclean || exit $$? ;\
	done
	-rm -f `basename $(CONFIG_H)` $(CONFIG_MAK) $(VERSION_H) .depend 
