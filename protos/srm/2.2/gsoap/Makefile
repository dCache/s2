SHELL = /bin/sh

# Include local configuration file (generated by ./configure) ########
_CONFIGURE_DIR	:= ../../../..
_CONFIGURE	:= $(_CONFIGURE_DIR)/configure
_CONFIG_MAK	:= $(_CONFIGURE_DIR)/config.mak
sinclude $(_CONFIG_MAK)

# Makefile variables #################################################
GSOAP_INCLUDE = -I$(_with_gsoapdir)/import
SOAPCPP2 = soapcpp2
WSDL2H = wsdl2h
SRM_H = srm_22.h

GENERATED_H= \
  soapH.h \
  soapsrmSoapBindingObject.h \
  soapsrmSoapBindingProxy.h \
  soapStub.h \
  $(SRM_H) \
  srmNsmap.h
GENERATED_SRC = \
  soapC.cpp \
  soapClient.cpp \
  soapClientLib.cpp \
  soapServer.cpp \
  soapServerLib.cpp


# Rules ##############################################################
.PHONY: Makefile

all: $(GENERATED_SRC) $(GENERATED_H) objects 

$(GENERATED_SRC) $(GENERATED_H): srm.v2.2.wsdl
	$(WSDL2H) -t $(_with_gsoapdir)/typemap.dat -N srm -o $(SRM_H) $<
	$(SOAPCPP2) $(GSOAP_INCLUDE) $(SRM_H)
	-$(RM) srmNsmap.h
	-cat *.nsmap >>srmNsmap.h

%.o: %.cpp 
	$(CC) -g -c $(GSOAP_INCLUDE) $< -o $@

objects: soapC.o soapClient.o soapServer.o

# Install ############################################################
install:


# Cleanup ############################################################
.PHONY: clean distclean mclean

clean: cleanxml
	-$(RM) *.o $(LIBFILES) $(BINFILES)
	-$(RM) $(GENERATED_SRC)
	-$(RM) $(GENERATED_H)

.PHONY: cleanxml
cleanxml:
	-$(RM) *.xml
	-$(RM) *.nsmap
	-$(RM) *.cpp
	-${RM} *.h

distclean mclean: clean
	-$(RM) -f `basename $(CONFIG_H)` $(CONFIG_MAK) $(VERSION_H) .depend 
